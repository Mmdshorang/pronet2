<?php

namespace Database\Seeders;

use App\Models\User;
use App\Models\UserRating;
use App\Models\RatingCriteria;
use Illuminate\Database\Seeder;

class UserRatingSeeder extends Seeder
{
    public function run(): void
    {
        $users = User::where('role', 'user')->get();
        $criteria = RatingCriteria::all();

        foreach ($users as $user) {
            // Create 2-3 ratings for each user
            for ($i = 0; $i < rand(2, 3); $i++) {
                $rating = UserRating::create([
                    'user_id' => $user->id,
                    'reviewer_id' => User::where('role', 'admin')->first()->id,
                    'overall_rating' => rand(3, 5),
                    'comment' => $this->getRandomComment(),
                ]);

                // Attach 3-5 random criteria to each rating
                $selectedCriteria = $criteria->random(rand(3, 5));
                foreach ($selectedCriteria as $criterion) {
                    $rating->criteria()->attach($criterion->id, [
                        'score' => rand(3, 5),
                        'comment' => $this->getRandomCriterionComment($criterion->name),
                    ]);
                }
            }
        }
    }

    private function getRandomComment(): string
    {
        $comments = [
            'توسعه‌دهنده بسیار خوبی است و همیشه کارها را به موقع تحویل می‌دهد.',
            'تسلط خوبی بر تکنولوژی‌های مورد نیاز دارد.',
            'توانایی حل مسئله بالایی دارد و همیشه راه‌حل‌های خلاقانه ارائه می‌دهد.',
            'با اعضای تیم همکاری خوبی دارد و همیشه آماده کمک به دیگران است.',
            'مدیریت زمان خوبی دارد و پروژه‌ها را به موقع تحویل می‌دهد.',
            'مستندات فنی را به خوبی می‌نویسد و کدهای تمیزی تولید می‌کند.',
            'علاقه زیادی به یادگیری تکنولوژی‌های جدید دارد.',
            'توانایی برقراری ارتباط موثری با مشتریان و همکاران دارد.',
            'خلاقیت بالایی در حل مشکلات دارد.',
            'مدیریت پروژه خوبی دارد و همیشه در جلسات حضور فعال دارد.',
        ];

        return $comments[array_rand($comments)];
    }

    private function getRandomCriterionComment(string $criterionName): string
    {
        $comments = [
            'تخصص فنی' => [
                'تسلط بسیار خوبی بر تکنولوژی‌های مورد نیاز دارد.',
                'دانش فنی بالایی دارد و همیشه به‌روز است.',
                'توانایی حل مشکلات پیچیده را دارد.',
            ],
            'حل مسئله' => [
                'توانایی بالایی در حل مشکلات پیچیده دارد.',
                'راه‌حل‌های خلاقانه‌ای ارائه می‌دهد.',
                'مشکلات را به خوبی تحلیل می‌کند.',
            ],
            'کار تیمی' => [
                'با اعضای تیم همکاری خوبی دارد.',
                'همیشه آماده کمک به دیگران است.',
                'در جلسات تیمی مشارکت فعال دارد.',
            ],
            'مدیریت زمان' => [
                'پروژه‌ها را به موقع تحویل می‌دهد.',
                'مدیریت زمان خوبی دارد.',
                'اولویت‌بندی کارها را به خوبی انجام می‌دهد.',
            ],
            'یادگیری مستمر' => [
                'علاقه زیادی به یادگیری تکنولوژی‌های جدید دارد.',
                'همیشه در حال به‌روزرسانی دانش خود است.',
                'از تجربیات دیگران درس می‌گیرد.',
            ],
            'کیفیت کد' => [
                'کدهای تمیز و قابل نگهداری می‌نویسد.',
                'از بهترین شیوه‌های کدنویسی پیروی می‌کند.',
                'کدهایش به خوبی مستندسازی شده است.',
            ],
            'مستندسازی' => [
                'مستندات فنی را به خوبی می‌نویسد.',
                'توضیحات کافی برای کدها ارائه می‌دهد.',
                'مستنداتش برای دیگران قابل فهم است.',
            ],
            'خلاقیت' => [
                'راه‌حل‌های خلاقانه‌ای ارائه می‌دهد.',
                'در حل مشکلات نوآوری می‌کند.',
                'ایده‌های جدیدی برای بهبود پروژه دارد.',
            ],
            'ارتباطات' => [
                'توانایی برقراری ارتباط موثری با همکاران دارد.',
                'به خوبی با مشتریان ارتباط برقرار می‌کند.',
                'نظرات و پیشنهاداتش را به خوبی مطرح می‌کند.',
            ],
            'مدیریت پروژه' => [
                'پروژه‌ها را به خوبی مدیریت می‌کند.',
                'در جلسات حضور فعال دارد.',
                'نقش‌های تیمی را به خوبی انجام می‌دهد.',
            ],
        ];

        return $comments[$criterionName][array_rand($comments[$criterionName])] ?? 'عملکرد خوبی در این زمینه دارد.';
    }
} 